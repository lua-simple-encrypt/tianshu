# ============================================================================
# Tianshu (天枢) - 生产环境核心配置
# ============================================================================

# ----------------------------------------------------------------------------
# 1. 应用与端口配置
# ----------------------------------------------------------------------------
API_PORT=8080
WORKER_PORT=8001
MCP_PORT=8002
FRONTEND_PORT=80
LOG_LEVEL=INFO

# ----------------------------------------------------------------------------
# 2. 安全与认证 (重要：请立即修改密钥)
# ----------------------------------------------------------------------------
JWT_SECRET_KEY=9af7b5e43c12d8a6f91b0e3d2c5a1f8e7d6c5b4a39281706f5e4d3c2b1a0f9e8
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=60

# ----------------------------------------------------------------------------
# 3. GPU 与内存管理 (针对 VLM 任务优化)
# ----------------------------------------------------------------------------
# 宿主机拥有的物理 GPU 数量
GPU_COUNT=1
# 容器内逻辑可见的 GPU ID
CUDA_VISIBLE_DEVICES=0
# 每个 GPU 启动的并行进程数 (如果你显存 >= 24G，建议设为 1-2)
WORKER_GPUS=2
# Worker 的推理批处理大小
MAX_BATCH_SIZE=1
# 容器硬内存限制 (配合你 Docker Compose 的 32G SHM)
WORKER_MEMORY_LIMIT=24G
WORKER_MEMORY_RESERVATION=12G

# ----------------------------------------------------------------------------
# 4. PDF 自动分片 (实现万级页数并行处理)
# ----------------------------------------------------------------------------
PDF_SPLIT_ENABLED=true
# 超过 50 页即触发拆分 (分给不同 Worker 提升吞吐量)
PDF_SPLIT_THRESHOLD_PAGES=50
# 每个分片包含 20 页 (这样 100 页文件会产生 5 个并行子任务)
PDF_SPLIT_CHUNK_SIZE=20

# ----------------------------------------------------------------------------
# 5. 模型源配置 (对应你的 D 盘挂载逻辑)
# ----------------------------------------------------------------------------
# 设为 local 以触发 scripts/init-models.sh 跳过下载逻辑
MINERU_MODEL_SOURCE=local
MINERU_CONFIG_FILE=/root/mineru.json
# 宿主机上存放离线模型的路径 (用于 Docker Compose 引用)
OFFLINE_MODELS_PATH=D:/aiworkspace/models/mineru

# ----------------------------------------------------------------------------
# 6. 远程 vLLM 调度配置 (关键：对接 8118/8119)
# ----------------------------------------------------------------------------
# 指向宿主机上 8118 端口运行的 PaddleOCR-VL-1.5
PADDLE_VLM_URL=http://host.docker.internal:8118/v1
# 指向宿主机上 8119 端口运行的 MinerU-VLM-1.2B
MINERU_VLM_URL=http://host.docker.internal:8119/v1

# ----------------------------------------------------------------------------
# 7. 存储与数据库
# ----------------------------------------------------------------------------
DATABASE_PATH=/app/data/db/mineru_tianshu.db
OUTPUT_PATH=/app/data/output
UPLOAD_PATH=/app/data/uploads

# 是否启用 RustFS 对象存储 (若为 false，则使用本地文件服务)
RUSTFS_ENABLED=true
RUSTFS_ENDPOINT=rustfs:9000
RUSTFS_PUBLIC_URL=http://localhost:9000

# ----------------------------------------------------------------------------
# 8. 前端与 API 联动
# ----------------------------------------------------------------------------
VITE_API_BASE_URL=http://localhost:8080
